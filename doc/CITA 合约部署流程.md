## 环境准备

### 系统环境准备

目前测试环境为：

- Ubuntu 16.04 / MacOS 10.15 

### 环境准备

以下均使用 cita 测试网 https://testnet.citahub.com 来测试合约的部署和调用流程。

1. 安装 cita-cli
到网站 https://github.com/citahub/cita-cli/releases 下载安装 cita-cli。

2. 生成 account
```
./cita-cli key create > key.json
cat key.json
```
返回
```
{
  "address": "0x51b53602bf8ecaef55239fc6d3d2b20379253fb3",
  "private": "0xae469f2a07999b3ed42728b7afff2e1219441a0ef65f5e6192f2d8f0a47601b1",
  "public": "0x85e2314742a0f83144a3cd7f37885b9e5fe1957f88bf16f89cea89f3230a3f100be356babb9f9d828b0c49a100c840c5d24e7a43c9058aa1380b3ad218e7cff9"
}
```

3. 申请测试币
到网站 https://faucet.citahub.com/faucet/getNos 申请测试币

4. 查询账户余额
```
./cita-cli rpc getBalance \
--address 0x51b53602bf8ecaef55239fc6d3d2b20379253fb3 \
--url https://testnet.citahub.com
```
返回
```
{
  "id": 1,
  "jsonrpc": "2.0",
  "result": "0x65a4d9e22ee90e2b600"
}
```

### 编译合约

1. 进入到smart-audit源码文件下，然后进入到`src/cita`子目录。

2. 编译 FaceService.sol:

   ```shell
   solc oracles/face/FaceService.sol --bin
   ```
   返回:
   ```
   ======= oracles/face/FaceService.sol:FaceService =======
   Binary:
   6080604(此处略)
   ```

3. 编译 TimeService.sol:

   ```shell
   solc oracles/time/TimeService.sol --bin
   ```
   返回：
   ```
   ======= oracles/time/TimeService.sol:TimeService =======
   Binary:
   6080604(此处略)
   ```

4. 编译 IdentifyService.sol:

   ```shell
   solc oracles/identify/IdentifyService.sol --bin
   ```
   返回:
   ```
   ======= oracles/identify/IdentifyService.sol:IdentifyService =======
   Binary:
   6080604(此处略)
   ```

5. 编译 LocationService.sol:

   ```shell
   solc oracles/location/LocationService.sol --bin
   ```
   返回:
   ```
   ======= oracles/location/LocationService.sol:LocationService =======
   Binary:
   6080604(此处略)
   ```

6. 编译 audit.sol:

   ```
   ======= audit/audit.sol:Audit =======
   Binary:
   6080604(此处略)
   ```

### 部署合约

#### 部署时间合约

通过如下命令部署合约

   ```shell
   ./cita-cli rpc sendRawTransaction \
    --code 0x608060405234801561001057600080fd5b50610431806100206000396000f30060806040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680632ae64bb7146100515780639fd32a3a1461008e575b600080fd5b34801561005d57600080fd5b5061007860048036036100739190810190610231565b6100b7565b604051610085919061032c565b60405180910390f35b34801561009a57600080fd5b506100b560048036036100b09190810190610272565b610107565b005b60008082511115156100fe576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100f59061030c565b60405180910390fd5b60009050919050565b6000815111151561014d576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101449061030c565b60405180910390fd5b5050565b600082601f830112151561016457600080fd5b813561017761017282610374565b610347565b9150818183526020840193506020810190508360005b838110156101bd57813586016101a388826101c7565b84526020840193506020830192505060018101905061018d565b5050505092915050565b600082601f83011215156101da57600080fd5b81356101ed6101e88261039c565b610347565b9150808252602083016020830185838301111561020957600080fd5b6102148382846103e8565b50505092915050565b600061022982356103d8565b905092915050565b60006020828403121561024357600080fd5b600082013567ffffffffffffffff81111561025d57600080fd5b61026984828501610151565b91505092915050565b6000806040838503121561028557600080fd5b60006102938582860161021d565b925050602083013567ffffffffffffffff8111156102b057600080fd5b6102bc85828601610151565b9150509250929050565b6000601e82527fe6b3a8e5868ce8a784e58899e68980e99c80e58f82e695b0e4b88de8b6b300006020830152604082019050919050565b610306816103c8565b82525050565b60006020820190508181036000830152610325816102c6565b9050919050565b600060208201905061034160008301846102fd565b92915050565b6000604051905081810181811067ffffffffffffffff8211171561036a57600080fd5b8060405250919050565b600067ffffffffffffffff82111561038b57600080fd5b602082029050602081019050919050565b600067ffffffffffffffff8211156103b357600080fd5b601f19601f8301169050602081019050919050565b600063ffffffff82169050919050565b600063ffffffff82169050919050565b828183376000838301525050505600a265627a7a7230582019d038118c714985c7a61074130eecc8cb35f3bec14a915f0d83f7b6da2acd146c6578706572696d656e74616cf50037 \
    --private-key 0xae469f2a07999b3ed42728b7afff2e1219441a0ef65f5e6192f2d8f0a47601b1 \
    --url https://testnet.citahub.com
   ```

   返回：
   ```shell
   {
      "id": 4,
      "jsonrpc": "2.0",
      "result": {
         "hash": "0xac63ddfd47ce752286ef110a9402f011245d9e5211bad710ee0c0e400f185b0a",
         "status": "OK"
      }
   }
   ```

   获取合约地址：
   ```
   ./cita-cli rpc getTransactionReceipt \
      --hash 0xac63ddfd47ce752286ef110a9402f011245d9e5211bad710ee0c0e400f185b0a \
      --url https://testnet.citahub.com
   ```

   得到合约地址：0x568eae6fcac7c10bfd5258730cd20b0ed90dbc60


#### 部署定位合约

通过如下命令部署合约

   ```shell
   ./cita-cli rpc sendRawTransaction \
      --code 0x608060405234801561001057600080fd5b50610431806100206000396000f30060806040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680632ae64bb7146100515780639fd32a3a1461008e575b600080fd5b34801561005d57600080fd5b5061007860048036036100739190810190610231565b6100b7565b604051610085919061032c565b60405180910390f35b34801561009a57600080fd5b506100b560048036036100b09190810190610272565b610107565b005b60008082511115156100fe576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100f59061030c565b60405180910390fd5b60009050919050565b6000815111151561014d576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101449061030c565b60405180910390fd5b5050565b600082601f830112151561016457600080fd5b813561017761017282610374565b610347565b9150818183526020840193506020810190508360005b838110156101bd57813586016101a388826101c7565b84526020840193506020830192505060018101905061018d565b5050505092915050565b600082601f83011215156101da57600080fd5b81356101ed6101e88261039c565b610347565b9150808252602083016020830185838301111561020957600080fd5b6102148382846103e8565b50505092915050565b600061022982356103d8565b905092915050565b60006020828403121561024357600080fd5b600082013567ffffffffffffffff81111561025d57600080fd5b61026984828501610151565b91505092915050565b6000806040838503121561028557600080fd5b60006102938582860161021d565b925050602083013567ffffffffffffffff8111156102b057600080fd5b6102bc85828601610151565b9150509250929050565b6000601e82527fe6b3a8e5868ce8a784e58899e68980e99c80e58f82e695b0e4b88de8b6b300006020830152604082019050919050565b610306816103c8565b82525050565b60006020820190508181036000830152610325816102c6565b9050919050565b600060208201905061034160008301846102fd565b92915050565b6000604051905081810181811067ffffffffffffffff8211171561036a57600080fd5b8060405250919050565b600067ffffffffffffffff82111561038b57600080fd5b602082029050602081019050919050565b600067ffffffffffffffff8211156103b357600080fd5b601f19601f8301169050602081019050919050565b600063ffffffff82169050919050565b600063ffffffff82169050919050565b828183376000838301525050505600a265627a7a72305820f33a651b0e72d5ff19c0121cb396365acec9116500d394b377123959dfd3432d6c6578706572696d656e74616cf50037 \
      --private-key 0xae469f2a07999b3ed42728b7afff2e1219441a0ef65f5e6192f2d8f0a47601b1 \
      --url https://testnet.citahub.com
   ```

   返回：
   ```shell
   {
      "id": 4,
      "jsonrpc": "2.0",
      "result": {
         "hash": "0xe9e015f39435c49d0b6daa8b24da757a1fef25bb63fc603b7e023ee373bb3711",
         "status": "OK"
      }
   }
   ```

   获取合约地址：
   ```
   ./cita-cli rpc getTransactionReceipt \
      --hash 0xe9e015f39435c49d0b6daa8b24da757a1fef25bb63fc603b7e023ee373bb3711 \
      --url https://testnet.citahub.com
   ```

   得到合约地址：0x4254d2c7cd741ab3ff4b4c3ce97caed642be6bef

#### 部署人脸识别合约

通过如下命令部署合约

   ```shell
   ./cita-cli rpc sendRawTransaction \
    --code 0x608060405234801561001057600080fd5b50610431806100206000396000f30060806040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680632ae64bb7146100515780639fd32a3a1461008e575b600080fd5b34801561005d57600080fd5b5061007860048036036100739190810190610231565b6100b7565b604051610085919061032c565b60405180910390f35b34801561009a57600080fd5b506100b560048036036100b09190810190610272565b610107565b005b60008082511115156100fe576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100f59061030c565b60405180910390fd5b60009050919050565b6000815111151561014d576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101449061030c565b60405180910390fd5b5050565b600082601f830112151561016457600080fd5b813561017761017282610374565b610347565b9150818183526020840193506020810190508360005b838110156101bd57813586016101a388826101c7565b84526020840193506020830192505060018101905061018d565b5050505092915050565b600082601f83011215156101da57600080fd5b81356101ed6101e88261039c565b610347565b9150808252602083016020830185838301111561020957600080fd5b6102148382846103e8565b50505092915050565b600061022982356103d8565b905092915050565b60006020828403121561024357600080fd5b600082013567ffffffffffffffff81111561025d57600080fd5b61026984828501610151565b91505092915050565b6000806040838503121561028557600080fd5b60006102938582860161021d565b925050602083013567ffffffffffffffff8111156102b057600080fd5b6102bc85828601610151565b9150509250929050565b6000601e82527fe6b3a8e5868ce8a784e58899e68980e99c80e58f82e695b0e4b88de8b6b300006020830152604082019050919050565b610306816103c8565b82525050565b60006020820190508181036000830152610325816102c6565b9050919050565b600060208201905061034160008301846102fd565b92915050565b6000604051905081810181811067ffffffffffffffff8211171561036a57600080fd5b8060405250919050565b600067ffffffffffffffff82111561038b57600080fd5b602082029050602081019050919050565b600067ffffffffffffffff8211156103b357600080fd5b601f19601f8301169050602081019050919050565b600063ffffffff82169050919050565b600063ffffffff82169050919050565b828183376000838301525050505600a265627a7a723058200b938639cb27ee211188802626294bfd0d77bfe305c3eb77d279667dd2eb9f916c6578706572696d656e74616cf50037 \
    --private-key 0xae469f2a07999b3ed42728b7afff2e1219441a0ef65f5e6192f2d8f0a47601b1 \
    --url https://testnet.citahub.com
   ```

   返回：
   ```
   {
      "id": 4,
      "jsonrpc": "2.0",
      "result": {
         "hash": "0x0d0faedb62523ef3bd8c6ff74da2c228ddf7dd71f0e27583a4424809b5e4f773",
         "status": "OK"
      }
   }
   ```

   查询合约地址：
   ```
   ./cita-cli rpc getTransactionReceipt \
      --hash 0x0d0faedb62523ef3bd8c6ff74da2c228ddf7dd71f0e27583a4424809b5e4f773 \
      --url https://testnet.citahub.com
   ```

   得到合约地址：0xfd851fbbb503cf9a0d6f0a6b5b7db073ddbc5daf

#### 部署物体识别合约

通过如下命令部署合约

   ```shell
   ./cita-cli rpc sendRawTransaction \
      --code 0x608060405234801561001057600080fd5b50610431806100206000396000f30060806040526004361061004c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680632ae64bb7146100515780639fd32a3a1461008e575b600080fd5b34801561005d57600080fd5b5061007860048036036100739190810190610231565b6100b7565b604051610085919061032c565b60405180910390f35b34801561009a57600080fd5b506100b560048036036100b09190810190610272565b610107565b005b60008082511115156100fe576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100f59061030c565b60405180910390fd5b60009050919050565b6000815111151561014d576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101449061030c565b60405180910390fd5b5050565b600082601f830112151561016457600080fd5b813561017761017282610374565b610347565b9150818183526020840193506020810190508360005b838110156101bd57813586016101a388826101c7565b84526020840193506020830192505060018101905061018d565b5050505092915050565b600082601f83011215156101da57600080fd5b81356101ed6101e88261039c565b610347565b9150808252602083016020830185838301111561020957600080fd5b6102148382846103e8565b50505092915050565b600061022982356103d8565b905092915050565b60006020828403121561024357600080fd5b600082013567ffffffffffffffff81111561025d57600080fd5b61026984828501610151565b91505092915050565b6000806040838503121561028557600080fd5b60006102938582860161021d565b925050602083013567ffffffffffffffff8111156102b057600080fd5b6102bc85828601610151565b9150509250929050565b6000601e82527fe6b3a8e5868ce8a784e58899e68980e99c80e58f82e695b0e4b88de8b6b300006020830152604082019050919050565b610306816103c8565b82525050565b60006020820190508181036000830152610325816102c6565b9050919050565b600060208201905061034160008301846102fd565b92915050565b6000604051905081810181811067ffffffffffffffff8211171561036a57600080fd5b8060405250919050565b600067ffffffffffffffff82111561038b57600080fd5b602082029050602081019050919050565b600067ffffffffffffffff8211156103b357600080fd5b601f19601f8301169050602081019050919050565b600063ffffffff82169050919050565b600063ffffffff82169050919050565b828183376000838301525050505600a265627a7a72305820818617f5b35fb7295de96954b04c83411394c4b5dea4f0b894eea8372e8e27926c6578706572696d656e74616cf50037 \
      --private-key 0xae469f2a07999b3ed42728b7afff2e1219441a0ef65f5e6192f2d8f0a47601b1 \
      --url https://testnet.citahub.com
   ```

   返回：
   ```shell
   {
      "id": 4,
      "jsonrpc": "2.0",
      "result": {
         "hash": "0x71b1feaf3cf2c15e4f17112048f64421535354e9ef3169138d2459d50d25d4ad",
         "status": "OK"
      }
   }
   ```

   获取合约地址：
   ```
   ./cita-cli rpc getTransactionReceipt \
      --hash 0x71b1feaf3cf2c15e4f17112048f64421535354e9ef3169138d2459d50d25d4ad \
      --url https://testnet.citahub.com
   ```

   得到合约地址：0x47417dd1835f07a06ad93b4a262a7dd75b7cd550

#### 部署审计业务合约
   部署审计业务合约需要将上述合约地址传入作为构造参数。

   获取时间识别合约地址abi：
   ```
   ./cita-cli ethabi encode params --param address 568eae6fcac7c10bfd5258730cd20b0ed90dbc60
   ```
   返回："000000000000000000000000568eae6fcac7c10bfd5258730cd20b0ed90dbc60"

   获取定位识别合约地址abi：
   ```
   ./cita-cli ethabi encode params --param address 4254d2c7cd741ab3ff4b4c3ce97caed642be6bef
   ```
   返回："0000000000000000000000004254d2c7cd741ab3ff4b4c3ce97caed642be6bef"

   获取人脸识别合约地址abi：
   ```
   ./cita-cli ethabi encode params --param address fd851fbbb503cf9a0d6f0a6b5b7db073ddbc5daf
   ```
   返回："000000000000000000000000fd851fbbb503cf9a0d6f0a6b5b7db073ddbc5daf"

   获取物体识别合约地址abi：
   ```
   ./cita-cli ethabi encode params --param address 47417dd1835f07a06ad93b4a262a7dd75b7cd550
   ```
   返回："00000000000000000000000047417dd1835f07a06ad93b4a262a7dd75b7cd550"

将以上合约作为参数，附在审计合约后面，部署审计合约：
```
./cita-cli rpc sendRawTransaction \
    --code 0x60806040523480156200001157600080fd5b506040516080806200277d833981018060405262000033919081019062000180565b83838383836000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555082600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555081600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506000600360146101000a81548163ffffffff021916908363ffffffff16021790555050505050505050506200020c565b6000620001788251620001ec565b905092915050565b600080600080608085870312156200019757600080fd5b6000620001a7878288016200016a565b9450506020620001ba878288016200016a565b9350506040620001cd878288016200016a565b9250506060620001e0878288016200016a565b91505092959194509250565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b612561806200021c6000396000f3006080604052600436106100a4576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806304536686146100a957806310f25ff0146100d25780637ee57bdd1461010f5780638206d49f1461014c5780639982924c14610189578063a7a6f067146101c6578063adcdaca8146101ef578063bed34bba1461022c578063e7e4cfb714610269578063fef6d44414610292575b600080fd5b3480156100b557600080fd5b506100d060048036036100cb9190810190611ea9565b6102bb565b005b3480156100de57600080fd5b506100f960048036036100f49190810190611e57565b61040f565b60405161010691906122ce565b60405180910390f35b34801561011b57600080fd5b5061013660048036036101319190810190611d02565b61057e565b6040516101439190612312565b60405180910390f35b34801561015857600080fd5b50610173600480360361016e9190810190611e57565b610786565b60405161018091906122f0565b60405180910390f35b34801561019557600080fd5b506101b060048036036101ab9190810190611e57565b6108ae565b6040516101bd919061224c565b60405180910390f35b3480156101d257600080fd5b506101ed60048036036101e89190810190611df0565b61096f565b005b3480156101fb57600080fd5b5061021660048036036102119190810190611e57565b610b06565b6040516102239190612312565b60405180910390f35b34801561023857600080fd5b50610253600480360361024e9190810190611d84565b610b47565b6040516102609190612231565b60405180910390f35b34801561027557600080fd5b50610290600480360361028b9190810190611efd565b610cf8565b005b34801561029e57600080fd5b506102b960048036036102b49190810190611d43565b610e64565b005b60606000806000806102cc86610f31565b9450600460008863ffffffff1663ffffffff1681526020019081526020016000209350600092505b84518363ffffffff16101561040657848363ffffffff1681518110151561031757fe5b9060200190602002015160000151915083600101600083600481111561033957fe5b63ffffffff1663ffffffff16815260200190815260200160002060009054906101000a900463ffffffff1690507fe8f5ffaebf076bf3e35b8495c096da2aedf566fdb11fa840ae57277e67b3e93782600481111561039357fe5b82878663ffffffff168151811015156103a857fe5b90602001906020020151602001516040516103c59392919061235d565b60405180910390a16103f98282878663ffffffff168151811015156103e657fe5b90602001906020020151602001516110a0565b82806001019350506102f4565b50505050505050565b610417611919565b600a60008363ffffffff1663ffffffff168152602001908152602001600020606060405190810160405290816000820160009054906101000a900463ffffffff1663ffffffff1663ffffffff1681526020016000820160049054906101000a900463ffffffff1663ffffffff1663ffffffff16815260200160018201805480602002602001604051908101604052809291908181526020016000905b8282101561056f578382906000526020600020018054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561055b5780601f106105305761010080835404028352916020019161055b565b820191906000526020600020905b81548152906001019060200180831161053e57829003601f168201915b5050505050815260200190600101906104b3565b50505050815250509050919050565b60008060606000806000610591876112f2565b8095508196505050848360000160006101000a81548160ff021916908360038111156105b957fe5b0217905550600091505b83518263ffffffff1610156106995761061e848363ffffffff168151811015156105e957fe5b9060200190602002015160000151858463ffffffff1681518110151561060b57fe5b9060200190602002015160200151611472565b905080836001016000868563ffffffff1681518110151561063b57fe5b9060200190602002015160000151600481111561065457fe5b63ffffffff1663ffffffff16815260200190815260200160002060006101000a81548163ffffffff021916908363ffffffff16021790555081806001019250506105c3565b600360149054906101000a900463ffffffff16955082600460008863ffffffff1663ffffffff1681526020019081526020016000206000820160009054906101000a900460ff168160000160006101000a81548160ff021916908360038111156106ff57fe5b02179055509050506003601481819054906101000a900463ffffffff168092919060010191906101000a81548163ffffffff021916908363ffffffff160217905550507fd7576af0064f73ee557f2476f78be8bd967e2e0182e73c61fd818e79d1d9d6d8866040516107719190612312565b60405180910390a18595505050505050919050565b61078e611947565b600860008363ffffffff1663ffffffff16815260200190815260200160002060606040519081016040529081600082018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156108525780601f1061082757610100808354040283529160200191610852565b820191906000526020600020905b81548152906001019060200180831161083557829003601f168201915b505050505081526020016001820160009054906101000a900463ffffffff1663ffffffff1663ffffffff1681526020016001820160049054906101000a900463ffffffff1663ffffffff1663ffffffff16815250509050919050565b6060600660008363ffffffff1663ffffffff1681526020019081526020016000208054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156109635780601f1061093857610100808354040283529160200191610963565b820191906000526020600020905b81548152906001019060200180831161094657829003601f168201915b50505050509050919050565b600080600660008563ffffffff1663ffffffff1681526020019081526020016000209150600460008463ffffffff1663ffffffff16815260200190815260200160002090506007600081819054906101000a900463ffffffff168092919060010191906101000a81548163ffffffff021916908363ffffffff160217905550506060604051908101604052808681526020018563ffffffff1681526020018463ffffffff1681525060086000600760009054906101000a900463ffffffff1663ffffffff1663ffffffff1681526020019081526020016000206000820151816000019080519060200190610a64929190611975565b5060208201518160010160006101000a81548163ffffffff021916908363ffffffff16021790555060408201518160010160046101000a81548163ffffffff021916908363ffffffff1602179055509050507f85318a464ad3fe68bf958a2c6da7b8cf5078b07ee7fdc84dd31781c7709ecdc7600760009054906101000a900463ffffffff16604051610af79190612312565b60405180910390a15050505050565b600080600860008463ffffffff1663ffffffff16815260200190815260200160002090508060010160009054906101000a900463ffffffff16915050919050565b6000816040516020018082805190602001908083835b602083101515610b825780518252602082019150602081019050602083039250610b5d565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b602083101515610beb5780518252602082019150602081019050602083039250610bc6565b6001836020036101000a038019825116818451168082178552505050505050905001915050604051809103902060001916836040516020018082805190602001908083835b602083101515610c555780518252602082019150602081019050602083039250610c30565b6001836020036101000a0380198251168184511680821785525050505050509050019150506040516020818303038152906040526040518082805190602001908083835b602083101515610cbe5780518252602082019150602081019050602083039250610c99565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405180910390206000191614905092915050565b600080600660008663ffffffff1663ffffffff1681526020019081526020016000209150600860008563ffffffff1663ffffffff1681526020019081526020016000209050610d5b8160010160049054906101000a900463ffffffff16846102bb565b6009600081819054906101000a900463ffffffff168092919060010191906101000a81548163ffffffff021916908363ffffffff160217905550506060604051908101604052808663ffffffff1681526020018563ffffffff16815260200184815250600a6000600960009054906101000a900463ffffffff1663ffffffff1663ffffffff16815260200190815260200160002060008201518160000160006101000a81548163ffffffff021916908363ffffffff16021790555060208201518160000160046101000a81548163ffffffff021916908363ffffffff1602179055506040820151816001019080519060200190610e599291906119f5565b509050505050505050565b6005600081819054906101000a900463ffffffff168092919060010191906101000a81548163ffffffff021916908363ffffffff160217905550508060066000600560009054906101000a900463ffffffff1663ffffffff1663ffffffff1681526020019081526020016000209080519060200190610ee4929190611a55565b507fae25851acf0995f0d20e1a764c91e497e4bd808492e4a63546eda9ce4915735c600560009054906101000a900463ffffffff16604051610f269190612312565b60405180910390a150565b6060600080600060028551811515610f4557fe5b04604051908082528060200260200182016040528015610f7f57816020015b610f6c611ad5565b815260200190600190039081610f645790505b50935060009250600091505b84516001830163ffffffff16101561109557610fc3858363ffffffff16815181101515610fb457fe5b906020019060200201516116e6565b905060006004811115610fd257fe5b816004811115610fde57fe5b14151515611021576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016110189061228e565b60405180910390fd5b604080519081016040528082600481111561103857fe5b8152602001866001850163ffffffff1681518110151561105457fe5b90602001906020020151815250848463ffffffff1681518110151561107557fe5b906020019060200201819052508280600101935050600282019150610f8b565b839350505050919050565b60006060600360048111156110b157fe5b8560048111156110bd57fe5b14156110ec576000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff16915061120d565b6004808111156110f857fe5b85600481111561110457fe5b141561113457600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16915061120c565b6001600481111561114157fe5b85600481111561114d57fe5b141561117d57600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16915061120b565b6002600481111561118a57fe5b85600481111561119657fe5b14156111c657600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16915061120a565b60001515611209576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016112009061226e565b60405180910390fd5b5b5b5b5b600160405190808252806020026020018201604052801561124257816020015b606081526020019060019003908161122d5790505b5090508281600081518110151561125557fe5b906020019060200201819052508173ffffffffffffffffffffffffffffffffffffffff16639fd32a3a85836040518363ffffffff167c01000000000000000000000000000000000000000000000000000000000281526004016112b992919061232d565b600060405180830381600087803b1580156112d357600080fd5b505af11580156112e7573d6000803e3d6000fd5b505050505050505050565b600060606000806000808651111515611340576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611337906122ae565b60405180910390fd5b61136186600081518110151561135257fe5b90602001906020020151611826565b94506002865181151561137057fe5b046040519080825280602002602001820160405280156113aa57816020015b611397611afa565b81526020019060019003908161138f5790505b50935060009250600191505b85516001830163ffffffff161015611464576113ee868363ffffffff168151811015156113df57fe5b906020019060200201516116e6565b9050604080519081016040528082600481111561140757fe5b8152602001876001850163ffffffff1681518110151561142357fe5b90602001906020020151815250848463ffffffff1681518110151561144457fe5b9060200190602002018190525082806001019350506002820191506113b6565b848494509450505050915091565b60008060606003600481111561148457fe5b85600481111561149057fe5b14156114bf576000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1691506115e0565b6004808111156114cb57fe5b8560048111156114d757fe5b141561150757600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1691506115df565b6001600481111561151457fe5b85600481111561152057fe5b141561155057600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1691506115de565b6002600481111561155d57fe5b85600481111561156957fe5b141561159957600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1691506115dd565b600015156115dc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016115d39061226e565b60405180910390fd5b5b5b5b5b600160405190808252806020026020018201604052801561161557816020015b60608152602001906001900390816116005790505b5090508381600081518110151561162857fe5b906020019060200201819052508173ffffffffffffffffffffffffffffffffffffffff16632ae64bb7826040518263ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040161168a919061220f565b602060405180830381600087803b1580156116a457600080fd5b505af11580156116b8573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506116dc9190810190611e80565b9250505092915050565b6000611727826040805190810160405280600481526020017f54696d6500000000000000000000000000000000000000000000000000000000815250610b47565b156117355760019050611821565b611774826040805190810160405280600881526020017f4c6f636174696f6e000000000000000000000000000000000000000000000000815250610b47565b156117825760029050611821565b6117c1826040805190810160405280600d81526020017f466163655265636f676e697a6500000000000000000000000000000000000000815250610b47565b156117cf5760039050611821565b61180e826040805190810160405280600f81526020017f4f626a6563745265636f676e697a650000000000000000000000000000000000815250610b47565b1561181c5760049050611821565b600090505b919050565b6000611867826040805190810160405280600381526020017f414e440000000000000000000000000000000000000000000000000000000000815250610b47565b156118755760029050611914565b6118b4826040805190810160405280600281526020017f4f52000000000000000000000000000000000000000000000000000000000000815250610b47565b156118c25760039050611914565b611901826040805190810160405280600381526020017f4e4f540000000000000000000000000000000000000000000000000000000000815250610b47565b1561190f5760019050611914565b600090505b919050565b606060405190810160405280600063ffffffff168152602001600063ffffffff168152602001606081525090565b60606040519081016040528060608152602001600063ffffffff168152602001600063ffffffff1681525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106119b657805160ff19168380011785556119e4565b828001600101855582156119e4579182015b828111156119e35782518255916020019190600101906119c8565b5b5090506119f19190611b1f565b5090565b828054828255906000526020600020908101928215611a44579160200282015b82811115611a43578251829080519060200190611a33929190611975565b5091602001919060010190611a15565b5b509050611a519190611b44565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10611a9657805160ff1916838001178555611ac4565b82800160010185558215611ac4579182015b82811115611ac3578251825591602001919060010190611aa8565b5b509050611ad19190611b1f565b5090565b604080519081016040528060006004811115611aed57fe5b8152602001606081525090565b604080519081016040528060006004811115611b1257fe5b8152602001606081525090565b611b4191905b80821115611b3d576000816000905550600101611b25565b5090565b90565b611b6d91905b80821115611b695760008181611b609190611b70565b50600101611b4a565b5090565b90565b50805460018160011615610100020316600290046000825580601f10611b965750611bb5565b601f016020900490600052602060002090810190611bb49190611b1f565b5b50565b600082601f8301121515611bcb57600080fd5b8135611bde611bd9826123c8565b61239b565b9150818183526020840193506020810190508360005b83811015611c245781358601611c0a8882611c2e565b845260208401935060208301925050600181019050611bf4565b5050505092915050565b600082601f8301121515611c4157600080fd5b8135611c54611c4f826123f0565b61239b565b91508082526020830160208301858383011115611c7057600080fd5b611c7b8382846124d4565b50505092915050565b600082601f8301121515611c9757600080fd5b8135611caa611ca58261241c565b61239b565b91508082526020830160208301858383011115611cc657600080fd5b611cd18382846124d4565b50505092915050565b6000611ce682356124c4565b905092915050565b6000611cfa82516124c4565b905092915050565b600060208284031215611d1457600080fd5b600082013567ffffffffffffffff811115611d2e57600080fd5b611d3a84828501611bb8565b91505092915050565b600060208284031215611d5557600080fd5b600082013567ffffffffffffffff811115611d6f57600080fd5b611d7b84828501611c84565b91505092915050565b60008060408385031215611d9757600080fd5b600083013567ffffffffffffffff811115611db157600080fd5b611dbd85828601611c84565b925050602083013567ffffffffffffffff811115611dda57600080fd5b611de685828601611c84565b9150509250929050565b600080600060608486031215611e0557600080fd5b600084013567ffffffffffffffff811115611e1f57600080fd5b611e2b86828701611c84565b9350506020611e3c86828701611cda565b9250506040611e4d86828701611cda565b9150509250925092565b600060208284031215611e6957600080fd5b6000611e7784828501611cda565b91505092915050565b600060208284031215611e9257600080fd5b6000611ea084828501611cee565b91505092915050565b60008060408385031215611ebc57600080fd5b6000611eca85828601611cda565b925050602083013567ffffffffffffffff811115611ee757600080fd5b611ef385828601611bb8565b9150509250929050565b600080600060608486031215611f1257600080fd5b6000611f2086828701611cda565b9350506020611f3186828701611cda565b925050604084013567ffffffffffffffff811115611f4e57600080fd5b611f5a86828701611bb8565b9150509250925092565b6000611f6f8261246d565b80845260208401935083602082028501611f8885612455565b60005b84811015611fc1578383038852611fa3838351612085565b9250611fae8261249b565b9150602088019750600181019050611f8b565b508196508694505050505092915050565b6000611fdd82612462565b80845260208401935083602082028501611ff685612448565b60005b8481101561202f578383038852612011838351612085565b925061201c8261248e565b9150602088019750600181019050611ff9565b508196508694505050505092915050565b612049816124a8565b82525050565b600061205a82612483565b80845261206e8160208601602086016124e3565b61207781612516565b602085010191505092915050565b600061209082612478565b8084526120a48160208601602086016124e3565b6120ad81612516565b602085010191505092915050565b6000601882527fe7bc96e7a081e7b1bbe59e8be5b09ae69caae694afe68c8100000000000000006020830152604082019050919050565b6000600f82527fe69caae689bee588b0e8a784e5889900000000000000000000000000000000006020830152604082019050919050565b6000601882527fe8a784e58899e8a7a3e69e90e58f82e695b0e4b88de8b6b300000000000000006020830152604082019050919050565b60006060830160008301516121786000860182612200565b50602083015161218b6020860182612200565b50604083015184820360408601526121a38282611fd2565b9150508091505092915050565b600060608301600083015184820360008601526121cd8282612085565b91505060208301516121e26020860182612200565b5060408301516121f56040860182612200565b508091505092915050565b612209816124b4565b82525050565b600060208201905081810360008301526122298184611f64565b905092915050565b60006020820190506122466000830184612040565b92915050565b60006020820190508181036000830152612266818461204f565b905092915050565b60006020820190508181036000830152612287816120bb565b9050919050565b600060208201905081810360008301526122a7816120f2565b9050919050565b600060208201905081810360008301526122c781612129565b9050919050565b600060208201905081810360008301526122e88184612160565b905092915050565b6000602082019050818103600083015261230a81846121b0565b905092915050565b60006020820190506123276000830184612200565b92915050565b60006040820190506123426000830185612200565b81810360208301526123548184611f64565b90509392505050565b60006060820190506123726000830186612200565b61237f6020830185612200565b81810360408301526123918184612085565b9050949350505050565b6000604051905081810181811067ffffffffffffffff821117156123be57600080fd5b8060405250919050565b600067ffffffffffffffff8211156123df57600080fd5b602082029050602081019050919050565b600067ffffffffffffffff82111561240757600080fd5b601f19601f8301169050602081019050919050565b600067ffffffffffffffff82111561243357600080fd5b601f19601f8301169050602081019050919050565b6000602082019050919050565b6000602082019050919050565b600081519050919050565b600081519050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b6000602082019050919050565b60008115159050919050565b600063ffffffff82169050919050565b600063ffffffff82169050919050565b82818337600083830152505050565b60005b838110156125015780820151818401526020810190506124e6565b83811115612510576000848401525b50505050565b6000601f19601f83011690509190505600a265627a7a723058209adc97f1877861406fa49cbd59abcef79b0665d8b7d1845bc1bc6ba93c497a2b6c6578706572696d656e74616cf50037000000000000000000000000fd851fbbb503cf9a0d6f0a6b5b7db073ddbc5daf00000000000000000000000047417dd1835f07a06ad93b4a262a7dd75b7cd550000000000000000000000000568eae6fcac7c10bfd5258730cd20b0ed90dbc600000000000000000000000004254d2c7cd741ab3ff4b4c3ce97caed642be6bef \
    --private-key 0xae469f2a07999b3ed42728b7afff2e1219441a0ef65f5e6192f2d8f0a47601b1 \
    --url https://testnet.citahub.com
```

返回：
```
{
  "id": 4,
  "jsonrpc": "2.0",
  "result": {
    "hash": "0xb7da130e99aa81501efcd3426215608f17e771553393a6b5f11ccd097cae2fbb",
    "status": "OK"
  }
}
```

获取合约地址：
```
./cita-cli rpc getTransactionReceipt \
    --hash 0xb7da130e99aa81501efcd3426215608f17e771553393a6b5f11ccd097cae2fbb \
    --url https://testnet.citahub.com
```

得到合约地址：0xaa92e9f291930dcda185bbeebe681bacc27dffd4


### 调用合约

#### 获取合约方法 hashes
```
solc audit/audit.sol --hashes
```

返回：
```
======= audit/audit.sol:Audit =======
Function signatures:
e7e4cfb7: addEvent(uint32,uint32,string[])
bed34bba: compareStrings(string,string)
9982924c: getAuditee(uint32)
adcdaca8: getMaintainers(uint32)
8206d49f: getProject(uint32)
10f25ff0: queryEvents(uint32)
fef6d444: registerAuditee(string)
a7a6f067: registerProject(string,uint32,uint32)
7ee57bdd: registerRules(string[])
04536686: validateRules(uint32,string[])

======= audit/rules.sol:Rules =======
Function signatures:
bed34bba: compareStrings(string,string)
7ee57bdd: registerRules(string[])
04536686: validateRules(uint32,string[])
```

#### 录入审计当事人

获取字符串 "yucong" abi编码，作为当事人名字。
```
./cita-cli ethabi encode params --param string yucong
```

返回：
```
000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000067975636f6e670000000000000000000000000000000000000000000000000000
```

调用合约方法 registerAuditee：
```
./cita-cli rpc sendRawTransaction \
    --code 0xfef6d444000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000067975636f6e670000000000000000000000000000000000000000000000000000 \
    --address 0xaa92e9f291930dcda185bbeebe681bacc27dffd4 \
    --private-key 0xae469f2a07999b3ed42728b7afff2e1219441a0ef65f5e6192f2d8f0a47601b1 \
    --url https://testnet.citahub.com
```

返回：
```
{
  "id": 4,
  "jsonrpc": "2.0",
  "result": {
    "hash": "0x3120741475258eb291cf471f2d9e98062fd5639a033cc2729aa7635cd0d05b47",
    "status": "OK"
  }
}
```

查看存根：
```
./cita-cli rpc getTransactionReceipt \
    --hash 0x3120741475258eb291cf471f2d9e98062fd5639a033cc2729aa7635cd0d05b47 \
    --url https://testnet.citahub.com
```

获得注册的审计人ID：
```
0x0000000000000000000000000000000000000000000000000000000000000001
```

#### 录入规则

获取参数 ["AND", "Time", "(>= 9) AND (<= 18)", "Location", "IN(39.9 116.3 1000)"] abi编码，作为规则内容。
```
./cita-cli ethabi encode params --param string "[\"AND\", \"Time\", \"(>= 9) AND (<= 18)\", \"Location\", \"IN(39.9 116.3 1000)\"]"
```

返回：
```
0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000000000003414e440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000454696d65000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000084c6f636174696f6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013400000000000000000000000000000000000000000000000000000000000000
```

调用合约方法 registerRules：
```
./cita-cli rpc sendRawTransaction \
    --code 0x7ee57bdd0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000000000003414e440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000454696d65000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000084c6f636174696f6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013400000000000000000000000000000000000000000000000000000000000000 \
    --address 0xaa92e9f291930dcda185bbeebe681bacc27dffd4 \
    --private-key 0xae469f2a07999b3ed42728b7afff2e1219441a0ef65f5e6192f2d8f0a47601b1 \
    --url https://testnet.citahub.com
```

返回：
```
{
  "id": 4,
  "jsonrpc": "2.0",
  "result": {
    "hash": "0x0f8b701f109ea9c8523986870f15d77e2f97a338f5de7417fe83594b180e05e5",
    "status": "OK"
  }
}
```

查看存根：
```
./cita-cli rpc getTransactionReceipt \
    --hash 0x0f8b701f109ea9c8523986870f15d77e2f97a338f5de7417fe83594b180e05e5 \
    --url https://testnet.citahub.com
```

获得注册的RuleID：
```
0x0000000000000000000000000000000000000000000000000000000000000001
```

#### 录入项目

获取参数 detail:"yucong_project", auditeeID:"1", relationID:"1" abi编码。
```
./cita-cli ethabi encode params --param string yucong_project --param uint32 1 --param uint32 1
```

返回：
```
000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000e7975636f6e675f70726f6a656374000000000000000000000000000000000000
```

调用合约方法 registerProject：
```
./cita-cli rpc sendRawTransaction \
    --code 0xa7a6f067000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000e7975636f6e675f70726f6a656374000000000000000000000000000000000000 \
    --address 0xaa92e9f291930dcda185bbeebe681bacc27dffd4 \
    --private-key 0xae469f2a07999b3ed42728b7afff2e1219441a0ef65f5e6192f2d8f0a47601b1 \
    --url https://testnet.citahub.com
```

返回：
```
{
  "id": 4,
  "jsonrpc": "2.0",
  "result": {
    "hash": "0x978b74325a30b8dc2cf43fb8a978e41f6222e5660e662582cab531be00d9a09d",
    "status": "OK"
  }
}
```

查看存根：
```
./cita-cli rpc getTransactionReceipt \
    --hash 0x978b74325a30b8dc2cf43fb8a978e41f6222e5660e662582cab531be00d9a09d \
    --url https://testnet.citahub.com
```

获得注册的项目ID：
```
0x0000000000000000000000000000000000000000000000000000000000000001
```


#### 新增审计事件

获取参数 auditeeID:1, projectID:1, value:["Time","2","Location","4"] abi编码。
```
./cita-cli ethabi encode params --param uint32 1 --param uint32 1 --param string "["Time","2","Location","4"]"
```

返回：
```
0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000000454696d65000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000084c6f636174696f6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013400000000000000000000000000000000000000000000000000000000000000
```

调用合约方法 registerProject：
```
./cita-cli rpc sendRawTransaction \
    --code 0xe7e4cfb70000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000000454696d65000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000084c6f636174696f6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000013400000000000000000000000000000000000000000000000000000000000000 \
    --address 0xaa92e9f291930dcda185bbeebe681bacc27dffd4 \
    --private-key 0xae469f2a07999b3ed42728b7afff2e1219441a0ef65f5e6192f2d8f0a47601b1 \
    --url https://testnet.citahub.com
```

返回：
```
{
  "id": 4,
  "jsonrpc": "2.0",
  "result": {
    "hash": "0x60db82e49ef1f899cc23e7daf8da55874cdd21b663bf78a595dd7f3ff76b3b9d",
    "status": "OK"
  }
}
```

查看存根：
```
./cita-cli rpc getTransactionReceipt \
    --hash 0x60db82e49ef1f899cc23e7daf8da55874cdd21b663bf78a595dd7f3ff76b3b9d \
    --url https://testnet.citahub.com
```

可获取被验证的审计事件：
```
0x00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000013200000000000000000000000000000000000000000000000000000000000000
```

## 参考链接

1. [cita-cil 使用文档](https://github.com/citahub/cita-cli)
2. [solidity 官方文档](https://solidity-cn.readthedocs.io/zh/develop/index.html)

