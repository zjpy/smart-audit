# 代码组织

### Go语言

Go语言相关代码都存储在`src`目录下，主要涉及以下子目录：

- core：存放与核心业务相关的代码
- oracles：存放与预言机服务相关的合约代码
- fabric：存放用于编译fabric区块链上智能合约的代码
- xchain：存放用于编译XuperChain区块链上智能合约的代码

以下对每一个子目录分别介绍：

#### core

用于存放核心业务逻辑，涉及的子目录有：

- common：存放基础通用逻辑
- contract：存放通用的合约定义逻辑
- invokes：用于合约调用入口封装
- orgnization：用于定义合约涉及到的人员定义
- project：存放与一个业务方向相关的代码
- record：存放通用的存储相关逻辑
- rules：存放规则定义、调用与验证等逻辑

#### oracles

用于存放与预言机服务相关逻辑，该目录下每一个子目录对应一个具体的预言机服务，目前支持的预言机服务有：

- face：人脸识别服务
- identify：物体识别服务
- location：定位服务
- time：时间服务

每一个预言机服务的子目录下主要涉及以下内容：

- invokes：用于与该预言机相关的合约调用入口封装
- service：存放与预言机服务相关的具体代码逻辑
- dummy：为service目录下的子目录，由于目前未配置具体预言机服务，这里在智能合约中模拟预言机服务的验证过程

#### fabric

存放与fabric平台相关的代码，主要涉及的子目录如下：

- contract：为了剥离平台无关代码，我们在`contract/contract`目录下定义了统一的智能合约抽象接口，该子目录为抽象接口的具体实现
- audit：存放核心（审计）智能合约的入口
- face：存放人脸识别智能合约的入口
- identify：存放物体识别智能合约的入口
- location：存放定位智能合约的入口
- time：存放时间智能合约的入口

#### xchain

存放与XuperChain平台相关的代码，主要涉及的子目录如下：

- contract：为了剥离平台无关代码，我们在`contract/contract`目录下定义了统一的智能合约抽象接口，该子目录为抽象接口的具体实现
- audit：存放核心（审计）智能合约的入口
- face：存放人脸识别智能合约的入口
- identify：存放物体识别智能合约的入口
- location：存放定位智能合约的入口
- time：存放时间智能合约的入口

## 编译说明

考虑到fabric1.4对go mod支持不好，这里通过go path方式组织代码。为了能够成功编译需要该合约代码的根目录加入到GOPATH环境变量中。缺少的依赖包可以go get获取。

### fabric智能合约编译

进入到`src/fabric`子目录，执行以下命令编译所有合约

```shell
make all
```

### XuperChain智能合约编译

进入到`src/xchain`子目录，执行以下命令编译所有合约

```shell
make all
```

## 注释说明

由于这次是国内比赛，为了具有更好的阅读体验建议所有的注释都以中文形式添加，目前有三种类型的注释：

- 以`todo`开头的是目前还没完成开发的，需要后续开发完成的工作
- 以`fixme`开头的是我们在本次比赛不会实现的部分，但需要相应的说明需要在商用的时候做，以及要做成什么样的
- 上述两种之外为普通注释，为了解释说明一些关键逻辑

**注意**注释也是比赛中重要的加分项，我们应该添加尽量多的注释。